<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campo Minado</title>
  <style>
    :root {
      --bg: #0a0a0f;
      --s1: #12121a;
      --s2: #1a1a24;
      --b1: rgba(255, 255, 255, 0.08);
      --t1: #f5f5f7;
      --t2: #8888a0;
      --t3: #555568;
      --ac: #ff6b35;
      --ac2: #ff8f65;
      --ok: #34d399;
      --err: #f87171;

      --num-1: #3b82f6;
      --num-2: #10b981;
      --num-3: #ef4444;
      --num-4: #8b5cf6;
      --num-5: #991b1b;
      --num-6: #14b8a6;
      --num-7: #1f2937;
      --num-8: #6b7280;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: var(--bg);
      color: var(--t1);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 16px;
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 16px;
      max-width: 600px;
      margin: 0 auto;
      width: 100%;
    }

    /* Header */
    .header {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }

    .status-card {
      background: linear-gradient(135deg, var(--s1) 0%, var(--s2) 100%);
      border: 1px solid var(--b1);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      backdrop-filter: blur(8px);
    }

    .status-label {
      font-size: 12px;
      color: var(--t2);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .status-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--ac);
      font-variant-numeric: tabular-nums;
      font-family: 'Monaco', 'Courier New', monospace;
    }

    /* Difficulty Selector */
    .difficulty-selector {
      margin-bottom: 16px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .difficulty-btn {
      padding: 8px 12px;
      border: 2px solid var(--b1);
      background: var(--s1);
      color: var(--t2);
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .difficulty-btn:active {
      transform: scale(0.95);
    }

    .difficulty-btn.active {
      border-color: var(--ac);
      background: linear-gradient(135deg, var(--ac) 0%, var(--ac2) 100%);
      color: white;
      box-shadow: 0 0 12px rgba(255, 107, 53, 0.3);
    }

    /* Game Board */
    .game-board {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 4px;
      padding: 12px;
      background: var(--s1);
      border: 1px solid var(--b1);
      border-radius: 12px;
      aspect-ratio: 1;
      margin-bottom: 20px;
      backdrop-filter: blur(8px);
    }

    .cell {
      aspect-ratio: 1;
      background: linear-gradient(135deg, var(--s2) 0%, var(--s1) 100%);
      border: 1px solid var(--b1);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.15s ease;
      position: relative;
      overflow: hidden;
      min-height: 44px;
      touch-action: manipulation;
    }

    .cell:active:not(.revealed):not(.flag-placed) {
      transform: scale(0.92);
      background: linear-gradient(135deg, var(--s1) 0%, var(--s2) 100%);
    }

    .cell.revealed {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.01) 100%);
      border-color: var(--t3);
      cursor: default;
    }

    .cell.mine {
      background: linear-gradient(135deg, rgba(248, 113, 113, 0.15) 0%, rgba(248, 113, 113, 0.1) 100%);
    }

    .cell.mine.exploded {
      animation: explosion 0.4s ease-out;
    }

    @keyframes explosion {
      0% {
        transform: scale(1) rotate(0deg);
        filter: brightness(1);
      }
      50% {
        transform: scale(1.15) rotate(5deg);
        filter: brightness(1.3);
      }
      100% {
        transform: scale(1) rotate(0deg);
        filter: brightness(0.8);
      }
    }

    .cell.flag-placed::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23ff6b35" stroke-width="2"><polyline points="5 17 21 17 21 5 14 12 21 5"></polyline></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      animation: flagWave 0.3s ease-out;
    }

    @keyframes flagWave {
      0% {
        transform: scale(0) rotate(-20deg);
      }
      100% {
        transform: scale(1) rotate(0deg);
      }
    }

    .cell.mine::before {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" fill="%23f87171"/><g fill="%23fff" opacity="0.6"><circle cx="9" cy="9" r="1.5"/><circle cx="15" cy="9" r="1.5"/><circle cx="9" cy="15" r="1.5"/><circle cx="15" cy="15" r="1.5"/></g></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      animation: minePulse 0.4s ease-out;
    }

    @keyframes minePulse {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .cell-number {
      font-weight: 700;
      font-size: 14px;
      font-variant-numeric: tabular-nums;
    }

    .cell.num-1 .cell-number { color: var(--num-1); }
    .cell.num-2 .cell-number { color: var(--num-2); }
    .cell.num-3 .cell-number { color: var(--num-3); }
    .cell.num-4 .cell-number { color: var(--num-4); }
    .cell.num-5 .cell-number { color: var(--num-5); }
    .cell.num-6 .cell-number { color: var(--num-6); }
    .cell.num-7 .cell-number { color: var(--num-7); }
    .cell.num-8 .cell-number { color: var(--num-8); }

    /* Ripple effect for cascade reveal */
    @keyframes rippleReveal {
      0% {
        opacity: 0;
        transform: scale(0.8);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    .cell.ripple {
      animation: rippleReveal 0.3s ease-out;
    }

    /* Game Over States */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(10, 10, 15, 0.8);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      animation: overlayFade 0.3s ease-out forwards;
    }

    @keyframes overlayFade {
      to {
        opacity: 1;
        pointer-events: all;
      }
    }

    .game-over-modal {
      background: linear-gradient(135deg, var(--s1) 0%, var(--s2) 100%);
      border: 1px solid var(--b1);
      border-radius: 16px;
      padding: 32px 24px;
      text-align: center;
      max-width: 300px;
      animation: slideUp 0.4s ease-out;
      backdrop-filter: blur(8px);
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .game-over-icon {
      font-size: 48px;
      margin-bottom: 16px;
      display: inline-block;
      animation: bounce 0.6s ease-out;
    }

    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    .game-over-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--t1);
    }

    .game-over-subtitle {
      font-size: 14px;
      color: var(--t2);
      margin-bottom: 24px;
    }

    .game-over-score {
      background: var(--s2);
      border: 1px solid var(--b1);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
      font-size: 12px;
      color: var(--t2);
    }

    .score-label {
      display: block;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .score-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--ac);
      font-family: 'Monaco', 'Courier New', monospace;
    }

    .game-over-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    /* Footer */
    .footer {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--ac) 0%, var(--ac2) 100%);
      color: white;
      border: none;
    }

    .btn-primary:active {
      transform: scale(0.95);
      box-shadow: 0 0 12px rgba(255, 107, 53, 0.3);
    }

    .btn-secondary {
      background: var(--s1);
      color: var(--t1);
      border: 2px solid var(--b1);
    }

    .btn-secondary:active {
      transform: scale(0.95);
      background: var(--s2);
    }

    /* Toast Notifications */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: linear-gradient(135deg, var(--s1) 0%, var(--s2) 100%);
      color: var(--t1);
      padding: 12px 20px;
      border-radius: 8px;
      border: 1px solid var(--b1);
      font-size: 14px;
      z-index: 200;
      pointer-events: none;
      animation: toastSlideUp 0.3s ease-out forwards;
      backdrop-filter: blur(8px);
    }

    .toast.success {
      border-color: var(--ok);
      background: linear-gradient(135deg, rgba(52, 211, 153, 0.1) 0%, rgba(52, 211, 153, 0.05) 100%);
    }

    .toast.error {
      border-color: var(--err);
      background: linear-gradient(135deg, rgba(248, 113, 113, 0.1) 0%, rgba(248, 113, 113, 0.05) 100%);
    }

    @keyframes toastSlideUp {
      to {
        transform: translateX(-50%) translateY(0);
      }
    }

    /* Confetti */
    @keyframes confettiFall {
      to {
        transform: translateY(100vh) rotateZ(360deg);
        opacity: 0;
      }
    }

    .confetti {
      position: fixed;
      width: 8px;
      height: 8px;
      pointer-events: none;
      animation: confettiFall 3s ease-out forwards;
      z-index: 150;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .container {
        padding: 12px;
      }

      .game-board {
        gap: 3px;
        padding: 8px;
      }

      .cell {
        min-height: 44px;
        font-size: 12px;
      }

      .status-value {
        font-size: 24px;
      }

      .game-over-modal {
        max-width: 280px;
        padding: 24px 20px;
      }
    }

    @media (max-width: 360px) {
      .cell {
        min-height: 40px;
      }

      .cell-number {
        font-size: 12px;
      }

      .status-value {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header: Timer and Mines Counter -->
    <div class="header">
      <div class="status-card">
        <div class="status-label">Tempo</div>
        <div class="status-value" id="g-status">00:00</div>
      </div>
      <div class="status-card">
        <div class="status-label">Minas</div>
        <div class="status-value" id="g-score">10</div>
      </div>
    </div>

    <!-- Difficulty Selector -->
    <div class="difficulty-selector" id="difficulty-selector">
      <button class="difficulty-btn active" data-difficulty="easy">FÃ¡cil<br><small style="font-size:10px">9x9 / 10</small></button>
      <button class="difficulty-btn" data-difficulty="medium">MÃ©dio<br><small style="font-size:10px">9x9 / 40</small></button>
      <button class="difficulty-btn" data-difficulty="hard">DifÃ­cil<br><small style="font-size:10px">9x9 / 60</small></button>
    </div>

    <!-- Game Board -->
    <div class="game-board" id="game-board"></div>

    <!-- Footer: Buttons -->
    <div class="footer">
      <button class="btn btn-secondary" id="btn-desistir">Desistir</button>
      <button class="btn btn-primary" id="btn-novo-jogo">Novo Jogo</button>
    </div>
  </div>

  <!-- Game Over Modal -->
  <div class="overlay" id="overlay" style="display:none">
    <div class="game-over-modal">
      <div class="game-over-icon" id="modal-icon">ðŸŽ‰</div>
      <div class="game-over-title" id="modal-title">ParabÃ©ns!</div>
      <div class="game-over-subtitle" id="modal-subtitle">VocÃª venceu!</div>
      <div class="game-over-score">
        <span class="score-label">PontuaÃ§Ã£o</span>
        <span class="score-value" id="modal-score">0</span>
      </div>
      <div class="game-over-buttons">
        <button class="btn btn-secondary" onclick="closeModal()">Fechar</button>
        <button class="btn btn-primary" onclick="newGame()">Novo Jogo</button>
      </div>
    </div>
  </div>

  <!-- Bridge Script -->
  <script src="/games/core/bridge.js"></script>

  <!-- Game Script -->
  <script>
    'use strict';

    // Game Config
    const difficulties = {
      easy: { rows: 9, cols: 9, mines: 10, multiplier: 1 },
      medium: { rows: 9, cols: 9, mines: 40, multiplier: 2 },
      hard: { rows: 9, cols: 9, mines: 60, multiplier: 3 }
    };

    // Game State
    let gameState = {
      difficulty: 'easy',
      board: [],
      revealed: new Set(),
      flagged: new Set(),
      gameOver: false,
      won: false,
      startTime: null,
      timerInterval: null,
      firstMove: true,
      mines: new Set(),
    };

    // DOM Elements
    const gameBoardEl = document.getElementById('game-board');
    const statusEl = document.getElementById('g-status');
    const scoreEl = document.getElementById('g-score');
    const difficultySelector = document.getElementById('difficulty-selector');
    const btnDesistir = document.getElementById('btn-desistir');
    const btnNovoJogo = document.getElementById('btn-novo-jogo');
    const overlay = document.getElementById('overlay');

    // Initialize
    function init() {
      setupDifficultyButtons();
      newGame();
    }

    function setupDifficultyButtons() {
      difficultySelector.querySelectorAll('.difficulty-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          if (gameState.gameOver || gameState.won) {
            difficultySelector.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            gameState.difficulty = btn.dataset.difficulty;
            newGame();
          }
        });
      });
    }

    function newGame() {
      // Clear state
      clearInterval(gameState.timerInterval);
      gameState.revealed.clear();
      gameState.flagged.clear();
      gameState.gameOver = false;
      gameState.won = false;
      gameState.firstMove = true;
      gameState.mines.clear();
      gameState.startTime = null;
      statusEl.textContent = '00:00';

      const config = difficulties[gameState.difficulty];
      gameState.board = Array(config.rows * config.cols).fill(null).map(() => ({ adjacent: 0 }));

      updateScore();
      renderBoard();
      overlay.style.display = 'none';
    }

    function renderBoard() {
      const config = difficulties[gameState.difficulty];
      gameBoardEl.innerHTML = '';
      gameBoardEl.style.gridTemplateColumns = `repeat(${config.cols}, 1fr)`;

      for (let i = 0; i < config.rows * config.cols; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.id = `cell-${i}`;
        cell.dataset.index = i;

        // Touch events
        cell.addEventListener('click', (e) => handleCellClick(e, i));
        cell.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          toggleFlag(i);
        });

        // Long press for flag (mobile)
        let touchStart = 0;
        cell.addEventListener('touchstart', (e) => {
          touchStart = Date.now();
        });
        cell.addEventListener('touchend', (e) => {
          if (Date.now() - touchStart > 500) {
            e.preventDefault();
            toggleFlag(i);
          }
        });

        // Double tap for flag (mobile)
        let lastTap = 0;
        cell.addEventListener('touchend', (e) => {
          const now = Date.now();
          if (now - lastTap < 300) {
            e.preventDefault();
            toggleFlag(i);
          }
          lastTap = now;
        });

        updateCellDisplay(cell, i);
        gameBoardEl.appendChild(cell);
      }
    }

    function updateCellDisplay(cellEl, index) {
      const isRevealed = gameState.revealed.has(index);
      const isFlagged = gameState.flagged.has(index);
      const isMine = gameState.mines.has(index);

      cellEl.classList.remove('revealed', 'flag-placed', 'mine', 'exploded', 'num-1', 'num-2', 'num-3', 'num-4', 'num-5', 'num-6', 'num-7', 'num-8');

      if (isRevealed) {
        cellEl.classList.add('revealed');
        cellEl.innerHTML = '';

        if (isMine) {
          cellEl.classList.add('mine');
          if (gameState.gameOver && !gameState.won) {
            cellEl.classList.add('exploded');
          }
        } else {
          const adjacent = gameState.board[index].adjacent;
          if (adjacent > 0) {
            cellEl.classList.add(`num-${adjacent}`);
            cellEl.innerHTML = `<span class="cell-number">${adjacent}</span>`;
          }
        }
      } else if (isFlagged) {
        cellEl.classList.add('flag-placed');
        cellEl.innerHTML = '';
      } else {
        cellEl.innerHTML = '';
      }
    }

    function handleCellClick(e, index) {
      e.preventDefault();
      if (gameState.gameOver || gameState.won) return;
      if (gameState.flagged.has(index)) return;

      if (gameState.firstMove) {
        gameState.firstMove = false;
        gameState.startTime = Date.now();
        startTimer();
        placeMines(index);
      }

      revealCell(index);
    }

    function placeMines(safeIndex) {
      const config = difficulties[gameState.difficulty];
      const totalCells = config.rows * config.cols;
      let placed = 0;

      while (placed < config.mines) {
        const index = Math.floor(Math.random() * totalCells);
        if (index !== safeIndex && !gameState.mines.has(index)) {
          gameState.mines.add(index);
          placed++;
        }
      }

      // Calculate adjacent mine counts
      for (let i = 0; i < totalCells; i++) {
        if (!gameState.mines.has(i)) {
          const adjacent = getAdjacentCells(i).filter(idx => gameState.mines.has(idx)).length;
          gameState.board[i].adjacent = adjacent;
        }
      }
    }

    function getAdjacentCells(index) {
      const config = difficulties[gameState.difficulty];
      const col = index % config.cols;
      const row = Math.floor(index / config.cols);
      const adjacent = [];

      for (let r = Math.max(0, row - 1); r <= Math.min(config.rows - 1, row + 1); r++) {
        for (let c = Math.max(0, col - 1); c <= Math.min(config.cols - 1, col + 1); c++) {
          const idx = r * config.cols + c;
          if (idx !== index) adjacent.push(idx);
        }
      }
      return adjacent;
    }

    function revealCell(index) {
      if (gameState.revealed.has(index) || gameState.flagged.has(index)) return;

      gameState.revealed.add(index);
      updateCellDisplay(document.getElementById(`cell-${index}`), index);

      if (gameState.mines.has(index)) {
        // Hit mine - lose
        gameOver(false);
        return;
      }

      // If no adjacent mines, cascade reveal
      if (gameState.board[index].adjacent === 0) {
        getAdjacentCells(index).forEach(adj => {
          if (!gameState.revealed.has(adj)) {
            setTimeout(() => {
              const cellEl = document.getElementById(`cell-${adj}`);
              if (cellEl) cellEl.classList.add('ripple');
              revealCell(adj);
            }, 30);
          }
        });
      }

      // Check win condition
      checkWin();
    }

    function toggleFlag(index) {
      if (gameState.revealed.has(index) || gameState.gameOver || gameState.won) return;
      if (gameState.flagged.has(index)) {
        gameState.flagged.delete(index);
        showToast('Bandeira removida');
      } else {
        gameState.flagged.add(index);
        showToast('Bandeira colocada', 'success');
      }
      updateCellDisplay(document.getElementById(`cell-${index}`), index);
      updateScore();
    }

    function checkWin() {
      const config = difficulties[gameState.difficulty];
      const totalCells = config.rows * config.cols;
      let revealedSafe = 0;

      for (let i = 0; i < totalCells; i++) {
        if (gameState.revealed.has(i) && !gameState.mines.has(i)) {
          revealedSafe++;
        }
      }

      if (revealedSafe === totalCells - config.mines) {
        gameState.won = true;
        gameOver(true);
      }
    }

    function gameOver(won) {
      gameState.gameOver = true;
      clearInterval(gameState.timerInterval);

      if (!won) {
        // Show all mines
        gameState.mines.forEach(idx => {
          gameState.revealed.add(idx);
          updateCellDisplay(document.getElementById(`cell-${idx}`), idx);
        });
        showGameOverModal(false);
        showToast('VocÃª perdeu! Toque em uma mina.', 'error');
      } else {
        showGameOverModal(true);
        createConfetti();
      }
    }

    function showGameOverModal(won) {
      const icon = document.getElementById('modal-icon');
      const title = document.getElementById('modal-title');
      const subtitle = document.getElementById('modal-subtitle');
      const score = document.getElementById('modal-score');

      if (won) {
        icon.textContent = 'ðŸŽ‰';
        title.textContent = 'ParabÃ©ns!';
        subtitle.textContent = 'VocÃª venceu!';
        const config = difficulties[gameState.difficulty];
        const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
        const points = elapsed * config.multiplier;
        score.textContent = points.toString();

        // Submit result to bridge
        touchBridge.submitResult({
          status: 'win',
          difficulty: gameState.difficulty,
          time: elapsed,
          score: points
        });
      } else {
        icon.textContent = 'ðŸ’¥';
        title.textContent = 'Que pena!';
        subtitle.textContent = 'VocÃª perdeu.';
        score.textContent = '0';

        touchBridge.submitResult({
          status: 'loss',
          difficulty: gameState.difficulty
        });
      }

      overlay.style.display = 'flex';
    }

    function closeModal() {
      overlay.style.display = 'none';
    }

    function createConfetti() {
      const colors = [
        'rgba(255, 107, 53, 0.8)',
        'rgba(255, 143, 101, 0.8)',
        'rgba(255, 193, 7, 0.8)',
        'rgba(52, 211, 153, 0.8)',
        'rgba(59, 130, 246, 0.8)'
      ];

      for (let i = 0; i < 30; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * window.innerWidth + 'px';
        confetti.style.top = '-10px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
        confetti.style.opacity = Math.random() * 0.7 + 0.3;
        document.body.appendChild(confetti);

        setTimeout(() => confetti.remove(), 3000);
      }
    }

    function startTimer() {
      gameState.timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
        const mins = Math.floor(elapsed / 60);
        const secs = elapsed % 60;
        statusEl.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
      }, 100);
    }

    function updateScore() {
      const config = difficulties[gameState.difficulty];
      const remaining = config.mines - gameState.flagged.size;
      scoreEl.textContent = Math.max(0, remaining).toString();
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }

    // Event Listeners
    btnDesistir.addEventListener('click', () => {
      if (!gameState.gameOver && !gameState.won) {
        gameState.gameOver = true;
        clearInterval(gameState.timerInterval);
        showToast('VocÃª desistiu do jogo', 'error');
        setTimeout(() => newGame(), 500);
      }
    });

    btnNovoJogo.addEventListener('click', newGame);

    // Prevent context menu
    document.addEventListener('contextmenu', (e) => {
      if (e.target.closest('.cell')) {
        e.preventDefault();
      }
    });

    // Start game
    init();
  </script>
</body>
</html>
